!function(g){"use strict";const h={data:{media:!1,mediaBrowse:!1,modal:!1,hidden:!1,width:{current:260,min:260,max:800},ui:{$container:null,$sidebar:null,$splitter:null,$toggle:null,$list:null,$tree:null,$mediaframe:null},uploader:{$container:null,instance:null,list:[]},loader:{counter:0,$spin:null,$lock:null,request:null},dragdrop:{$ghost:null,$target:null,items:null,isTouch:!1,timerId:null},splitter:{cursor:{startWidth:0,start:0,prev:0,current:0}},folder:{active:null,prev:null,copy:null},tree:null,filter:{timerId:null},click:{folder:null,timerId:null},contextmenu:{list:null}},fn:{run:()=>{if(console.log("MediaCommander: version "+mediacommander_sidebar_globals.data.version),h.globals=mediacommander_sidebar_globals,h.globals.data.type)if(h.notify=new MEDIACOMMANDER.PLUGINS.NOTIFY,h.colorpicker=new MEDIACOMMANDER.PLUGINS.COLORPICKER,h.data.meta=g.extend({},h.globals.data.meta),h.data.ticket=h.globals.data.ticket,"attachment"==h.globals.data.type){var a=g("#view-switch-list").hasClass("current");if(h.data.media=!(a||"undefined"==typeof wp||!wp.media||!wp.media.view),h.data.media){if("function"==typeof wp.Uploader&&g.extend(wp.Uploader.prototype,{init:function(){this.uploader&&(h.data.uploader.instance=this.uploader,this.uploader.bind("FileFiltered",function(a,e){e._folder=h.data.folder.active}),this.uploader.bind("FilesAdded",function(a,e){for(const t of e)h.fn.uploader.addFile(t);h.fn.uploader.updateHeader(),h.fn.uploader.open()}),this.uploader.bind("BeforeUpload",function(a,e){e._folder&&(a=a.settings.multipart_params,0<(e=parseInt(e._folder))?a.folder=e:"folder"in a&&delete a.folder)}),this.uploader.bind("UploadProgress",function(a,e){}),this.uploader.bind("FileUploaded",function(a,e){h.fn.uploader.completeFile(e)}),this.uploader.bind("UploadComplete",function(a,e){h.fn.uploader.complete()}))}}),wp.media.view.AttachmentsBrowser){const e=wp.media.view.AttachmentsBrowser;wp.media.view.AttachmentsBrowser=wp.media.view.AttachmentsBrowser.extend({createToolbar:function(){h.data.attachmentsBrowser=this,h.data.mediaBrowse=!(!this.model.attributes.router||"browse"!=this.model.attributes.router),h.fn.updateMediaGridSort(),e.prototype.createToolbar.apply(this,arguments)}})}if(wp.media.view.MediaFrame.EditAttachments){const t=wp.media.view.MediaFrame.EditAttachments;wp.media.view.MediaFrame.EditAttachments=wp.media.view.MediaFrame.EditAttachments.extend({initialize:function(){h.data.editAttachments=this,t.prototype.initialize.apply(this,arguments)},updateMediaData:function(){const a=h.data.editAttachments;fetch(a.model.attributes.url,{cache:"reload",mode:"no-cors"}).then(()=>{a.model.fetch().done(()=>{a.rerender(a.model)})})}})}}g("body").hasClass("upload-php")?(h.fn.ajaxPrefilter(),h.fn.loadSidebar()):h.data.media&&wp.media.view.Modal&&((h.data.ticket||wp&&wp.blocks)&&h.fn.ajaxPrefilter(),wp.media.view.Modal.prototype.on("prepare",h.fn.onMediaModalPrepare),wp.media.view.Modal.prototype.on("open",h.fn.onMediaModalOpen),wp.media.view.Modal.prototype.on("close",h.fn.onMediaModalClose))}else h.fn.loadSidebar()},ajaxPrefilter:()=>{g.ajaxPrefilter((a,e,t)=>{"POST"===e.type&&e.data&&"query-attachments"==e.data.action&&h.data.mediaBrowse&&(e.data=g.extend(e.data,{mediacommander_mode:"grid"}),a.data=g.param(e.data))})},processData:(a,e,t={},d,o)=>{const r=g.Deferred();return d||h.fn.loading(!0,o),o=g.ajax({url:h.globals.api.url+"/"+a,type:"GET"==e?"GET":"POST",cache:!1,dataType:"json",contentType:"application/json",headers:{"X-WP-Nonce":h.globals.api.nonce,"X-HTTP-Method-Override":e},data:"GET"===e?t:JSON.stringify(t)}).done(a=>{a&&a.success?r.resolve(a.data):r.reject()}).fail(()=>{r.reject()}).always(()=>{d||h.fn.loading(!1)}),{...r.promise(),abort:o.abort}},getData:(a,e={},t,d)=>h.fn.processData(a,"GET",e,t,d),createData:(a,e={},t,d)=>h.fn.processData(a,"POST",e,t,d),updateData:(a,e={},t,d)=>h.fn.processData(a,"PUT",e,t,d),deleteData:(a,e={},t,d)=>h.fn.processData(a,"DELETE",e,t,d),loadProposal:()=>{h.data.hidden="true"===Cookies.get("mcmd-sidebar-hidden"),h.fn.prebuild(),h.fn.updateWidth(),h.fn.getData("template",{name:"proposal"}).done(a=>{h.fn.build(a,!0),g.when(h.fn.updateWidth()).done(()=>{h.fn.bind(!0),h.fn.ready()})})},loadSidebar:()=>{h.data.hidden="true"===Cookies.get("mcmd-sidebar-hidden"),h.fn.prebuild(),h.fn.updateWidth(),g.when(h.fn.getData("contextmenu"),h.fn.getData("meta",{type:h.globals.data.type}),h.fn.getData("template",{name:"sidebar"})).done((a,e,t)=>{h.data.contextmenu.list=a,h.data.meta=e,h.fn.build(t),g.when(h.fn.updateWidth(),h.fn.updateFoldersData(),h.fn.updateFoldersAttachCount()).done(()=>{h.fn.updateNoticeAndSearch(),h.fn.activateFolder(h.data.meta.folder,!0,!0),h.fn.collapseFolders(h.data.meta.collapsed),h.fn.initAttachments(),h.fn.bind(),h.fn.ready()})})},loading:(a,e)=>{a?(h.data.loader.counter++,h.data.loader.$spin.toggleClass("mcmd-active",!0),h.data.loader.$lock.toggleClass("mcmd-active",!e)):(h.data.loader.counter--,h.data.loader.counter<=0&&(h.data.loader.$spin.toggleClass("mcmd-active",!1),h.data.loader.$lock.toggleClass("mcmd-active",!1),h.data.loader.counter=0))},prebuild:()=>{var a,e,t;h.data.loader.$spin=g("<div>").addClass("mcmd-spin"),h.data.loader.$lock=g("<div>").addClass("mcmd-lock"),h.data.ui.$container=g("<div>").addClass("mcmd-container").toggleClass("mcmd-hidden",h.data.hidden),h.data.ui.$sidebar=g("<div>").addClass("mcmd-sidebar").toggleClass("mcmd-disable-tree-labels",h.globals.data.disable_counter).toggleClass("mcmd-disable-search-bar",h.globals.data.disable_search_bar),h.data.ui.$splitter=g("<div>").addClass("mcmd-splitter"),h.data.ui.$toggle=g("<div>").addClass("mcmd-toggle"),h.data.ui.$list=g("<div>").addClass("mcmd-list"),h.data.ui.$minitools=g("<div>").addClass("mcmd-minitools"),h.data.ui.$minitools.append(h.data.ui.$toggle,h.data.loader.$spin),h.data.modal||(a=g("#wpadminbar").height(),h.data.ui.$sidebar.css({position:"sticky",top:a+"px",height:"calc(100% - 1px)",width:h.data.width.current}),(a=(()=>{for(const a of g("#wpbody .wrap"))if(!g(a).is(":empty"))return g(a);return null})()).wrap(h.data.ui.$list),h.data.ui.$list=a.parent(),h.data.ui.$list.wrap(h.data.ui.$container).before(h.data.ui.$sidebar,h.data.ui.$splitter).append(h.data.ui.$minitools),h.data.ui.$container=h.data.ui.$sidebar.parent().addClass("mcmd-screen-type"),a=g("<div>").addClass("mcmd-ph-toolbar"),e=g("<div>").addClass("mcmd-ph-panel"),t=g("<div>").addClass("mcmd-ph-panel-tree"),h.data.ui.$sidebar.append(a,e,t))},build:(a,e)=>{h.data.ui.$sidebar.empty().append(a).append(h.data.loader.$lock),h.data.ui.$tree=h.data.ui.$sidebar.find("#mcmd-tree"),e||(h.globals.data.default_color&&document.documentElement.style.setProperty("--mcmd-default-folder-color",h.globals.data.default_color),h.globals.data.rights.c||h.data.ui.$sidebar.find("#mcmd-btn-create").remove(),"attachment"!==h.globals.data.type&&h.data.ui.$sidebar.find("#mcmd-btn-sort").remove(),h.globals.data.rights.c)||h.data.ui.$sidebar.find("#mcmd-toolbar").remove(),h.data.modal&&(a=g('div[id^="__wp-uploader-id-"].supports-drag-drop:visible'),h.data.ui.$mediaframe=g(`#${a.attr("id")} .media-frame`),h.data.ui.$mediaframe.prepend(h.data.ui.$container.append(h.data.ui.$sidebar)),h.data.ui.$mediaframe.find(".media-frame-title").prepend(h.data.ui.$minitools),h.data.ui.$container.addClass("mcmd-modal-type")),e||(a={callback:{loading:h.fn.loading,move:h.fn.moveFolders,collapse:h.fn.collapseFolder}},h.data.tree=MEDIACOMMANDER.PLUGINS.TREE("#mcmd-tree",a)),h.fn.uploader.build()},bind:a=>{h.data.ui.$toggle.on("click",h.fn.onToggleContainer),h.data.ui.$splitter.on("mousedown",h.fn.onSplitterMouseDown),a||(h.data.ui.$sidebar.find("#mcmd-btn-create").on("click",h.fn.onFolderCreate),h.data.ui.$sidebar.find("#mcmd-btn-sort").on("click",h.fn.onFolderSort),h.data.ui.$sidebar.find("#mcmd-search-input").on("input",h.fn.onSearchInput),h.data.ui.$sidebar.find("#mcmd-search-clear").on("click",h.fn.onSearchClear),h.data.ui.$sidebar.on("click",".mcmd-tree-item",h.fn.onFolderClick),h.data.ui.$sidebar.on("dblclick",".mcmd-tree-item",h.fn.onFolderDblClick),h.data.ui.$sidebar.on("contextmenu",".mcmd-tree-item",h.fn.onContextMenu),g(document).ajaxComplete(h.fn.onAjaxComplete),"attachment"==h.globals.data.type&&h.globals.data.media_hover_details&&g(document).on("mouseover",".attachment",h.fn.onShowMediaDetails))},ready:()=>{h.data.ui.$sidebar.addClass("mcmd-active"),h.data.ui.$splitter.addClass("mcmd-active"),h.data.ui.$toggle.addClass("mcmd-active"),h.data.ui.$container.addClass("mcmd-active"),h.data.ui.$mediaframe&&h.data.ui.$mediaframe.toggleClass("mcmd-active",!h.data.hidden),h.data.ui.$sidebar.find("#mcmd-toolbar").addClass("mcmd-active"),h.data.ui.$sidebar.find("#mcmd-panel").addClass("mcmd-active")},updateMeta:a=>{var e=(e=h.data.tree.getFlatData())?e.filter(a=>a.collapsed).map(a=>a.id):null,e={folder:h.data.folder.active,collapsed:e,sort:h.data.meta.sort};return h.fn.updateData("meta",{type:h.globals.data.type,meta:e},a,!0)},updateWidth:a=>{a=a||Cookies.get("mcmd-sidebar-width")||0,a=Math.min(Math.max(a,h.data.width.min),h.data.width.max),h.data.width.current=a,h.data.ui.$sidebar.css({width:a})},updateNoticeAndSearch:()=>{var a=h.globals.data.rights.c&&!(h.data.tree&&h.data.tree.hasItems());h.data.ui.$sidebar.find("#mcmd-notice-create").toggleClass("mcmd-active",a),h.data.ui.$sidebar.find("#mcmd-search").toggleClass("mcmd-active",!a),h.data.ui.$sidebar.find("#mcmd-panel-tree").toggleClass("mcmd-active",!a)},updateMediaGridSort:()=>{if(h.data.mediaBrowse){var a={orderby:"date",order:"DESC"};switch(h.data.meta.sort.items){case"name-asc":a.orderby="title",a.order="ASC";break;case"name-desc":a.orderby="title",a.order="DESC";break;case"date-asc":a.orderby="date",a.order="ASC";break;case"date-desc":a.orderby="date",a.order="DESC";break;case"mod-asc":a.orderby="modified",a.order="ASC";break;case"mod-desc":a.orderby="modified",a.order="DESC";break;case"author-asc":a.orderby="authorName",a.order="ASC";break;case"author-desc":a.orderby="authorName",a.order="DESC"}h.data.attachmentsBrowser&&h.data.attachmentsBrowser.collection&&h.data.attachmentsBrowser.collection.props.set({orderby:a.orderby,order:a.order})}},updateMediaGridData:()=>{h.fn.updateMediaGridSort(),h.data.attachmentsBrowser&&h.data.attachmentsBrowser.collection&&h.data.attachmentsBrowser.collection.props.set({ignore:+new Date})},updateListData:a=>{const e=g.Deferred();return h.fn.loading(!0,!0),a=g.ajax({method:"GET",url:a,dataType:"html"}).done(a=>{e.resolve(a)}).fail(()=>{e.reject()}).always(()=>{h.fn.loading(!1)}),{...e.promise(),abort:a.abort}},updateFoldersData:()=>h.fn.getData("folders",{type:h.globals.data.type}).done(a=>{for(const e of a)h.data.tree.addItem(e)}).fail(()=>{h.notify.show(h.globals.msg.failed,"mcmd-failed")}),updateFoldersAttachCount:a=>{var e;return h.globals.data.disable_counter?((e=g.Deferred()).resolve(),e.promise()):h.fn.getData("attachment/counters",{type:h.globals.data.type,folders:a}).done(a=>{for(const e of a)h.data.tree.updateItemLabel(e.id,e.count),-1!=e.id&&-2!=e.id||h.data.ui.$sidebar.find(`.mcmd-tree-item[data-id='${e.id}'] .mcmd-tree-label`).toggleClass("mcmd-tree-active",0!=e.count).text(e.count)})},reinitWordPressStuff:()=>{var a;window.inlineEditPost&&window.inlineEditPost.init(),"plugins"===h.globals.data.type&&(a=g("#updates-js")).length&&a.remove().appendTo("head")},initAttachments:()=>{h.data.dragdrop.$ghost=g("<div>").addClass("mcmd-attachment-drag-ghost"),h.data.media?h.globals.data.rights.a&&g(".media-frame .media-frame-content").on("mousedown touchstart",".attachment",h.fn.onAttachmentDown):(h.data.ui.$list.toggleClass("mcmd-can-attach",h.globals.data.rights.a),h.globals.data.rights.a&&g("#the-list").on("mousedown touchstart",".check-column",h.fn.onAttachmentDown))},dropAttachments:(a,e)=>{a&&h.data.folder.active!=a&&e&&e.length&&h.fn.updateData("attach",{type:h.globals.data.type,folder:a,attachments:e}).done(a=>{h.fn.updateFoldersAttachCount(a),h.fn.activateFolder(h.data.folder.active,!1,!0)}).fail(()=>{h.notify.show(h.globals.msg.failed,"mcmd-failed")})},activateFolder:(a,e,t)=>{h.data.folder.active==a&&!t||(h.data.folder.prev=h.data.folder.active,h.data.folder.active=a,h.data.ui.$sidebar.find(".mcmd-tree-item.mcmd-active").removeClass("mcmd-active"),h.data.ui.$sidebar.find(`.mcmd-tree-item[data-id='${a}']`).addClass("mcmd-active"),e)||(h.data.loader.request&&h.data.loader.request.abort(),h.data.loader.request=h.fn.updateMeta(),h.data.loader.request.done(()=>{var a;h.data.media?h.fn.updateMediaGridData():(("string"==typeof(a=Url.queryString("paged"))||a instanceof String)&&Url.updateSearchParam("paged","1",!1),h.globals.data.disable_ajax?window.location.reload():(h.data.loader.request=h.fn.updateListData(location.href),h.data.loader.request.done(e=>{var a=(()=>{for(const a of g(e).find("#wpbody .wrap"))if(!g(a).is(":empty"))return g(a);return null})();a&&(h.data.ui.$list.find(".wrap")[0].innerHTML=a[0].innerHTML,h.fn.initAttachments(),h.fn.reinitWordPressStuff())}).fail(()=>{h.data.loader.request=null}).always(()=>{h.data.loader.request=null})))}).fail(()=>{h.data.loader.request=null}).always(()=>{}))},collapseFolders:a=>{if(a&&a.length)for(const e of a)h.data.tree.collapseItem(e,!0)},createFolders:(a,e,t)=>{a&&a.length&&h.fn.createData("folders",{type:h.globals.data.type,names:a,color:e,parent:t}).done(a=>{for(const e of a)h.data.tree.addItem({id:e.id,title:e.title,color:e.color},t);h.fn.updateNoticeAndSearch()}).fail(()=>{h.notify.show(h.globals.msg.failed,"mcmd-failed")})},renameFolder:(a,t)=>{h.fn.updateData("folders",{type:h.globals.data.type,action:"rename",folders:[a],name:t}).done(a=>{for(const e of a)h.data.tree.updateItemTitle(e,t)}).fail(()=>{h.notify.show(h.globals.msg.failed,"mcmd-failed")})},colorFolders:(a,t)=>{a&&a.length&&h.fn.updateData("folders",{type:h.globals.data.type,action:"color",folders:a,color:t}).done(a=>{for(const e of a)h.data.tree.updateItemColor(e,t)}).fail(()=>{h.notify.show(h.globals.msg.failed,"mcmd-failed")})},moveFolders:function(e,a,t,d,o,r){const l=this;let i=[];switch(o){case"before":(i=(i=JSON.parse(JSON.stringify(d))).filter(a=>!e.includes(a))).splice(i.indexOf(t),0,...e);break;case"after":(i=(i=JSON.parse(JSON.stringify(d))).filter(a=>!e.includes(a))).splice(i.indexOf(t)+1,0,...e);break;case"inside":i=d.concat(e)}h.fn.updateData("folders",{type:h.globals.data.type,action:"move",folders:e,parent:a,sorting:i}).done(a=>{r&&"function"==typeof r&&r.call(l,a,t,o)}).fail(()=>{h.notify.show(h.globals.msg.failed,"mcmd-failed")})},collapseFolder:function(){h.data.loader.request&&h.data.loader.request.abort(),h.data.loader.request=h.fn.updateMeta(!0),h.data.loader.request.always(()=>{h.data.loader.request=null})},copyFolders:(a,e)=>{h.fn.createData("copyfolder",{type:h.globals.data.type,src:a,dst:e}).done(a=>{for(const e of a)h.data.tree.addItem(e,e.parent);h.fn.updateNoticeAndSearch()}).fail(()=>{h.notify.show(h.globals.msg.failed,"mcmd-failed")})},deleteFolders:(a,e)=>{a&&a.length&&h.fn.deleteData("folders",{type:h.globals.data.type,folders:a,deleteAttachments:e}).done(a=>{let e=!1;for(const t of a)h.data.tree.removeItem(t),e||h.data.folder.active!=t||(e=!0),h.data.folder.copy==t&&(h.data.folder.copy=null);h.fn.updateNoticeAndSearch(),h.fn.updateFoldersAttachCount(),h.data.folder.active<0?h.fn.activateFolder(h.data.folder.active,!1,!0):e&&h.fn.activateFolder(-1)}).fail(()=>{h.notify.show(h.globals.msg.failed,"mcmd-failed")})},downloadFolders:a=>{a&&a.length&&h.fn.getData("folders/download/url",{type:h.globals.data.type,folders:a}).done(a=>{window.open(a,"_blank")}).fail(()=>{h.notify.show(h.globals.msg.failed,"mcmd-failed")})},filterFolders:a=>{clearTimeout(h.data.filter.timerId),h.data.filter.timerId=setTimeout(()=>{h.data.tree.filter(a)},500)},onToggleContainer:()=>{h.data.hidden=!h.data.hidden,h.data.ui.$container.toggleClass("mcmd-hidden",h.data.hidden),h.data.ui.$mediaframe&&h.data.ui.$mediaframe.toggleClass("mcmd-active",!h.data.hidden),Cookies.set("mcmd-sidebar-hidden",h.data.hidden)},onSplitterMouseDown:a=>{a.preventDefault(),a.stopImmediatePropagation(),h.data.splitter.cursor.startWidth=h.data.width.current,h.data.splitter.cursor.start=h.data.splitter.prev=h.data.splitter.cursor.current=a.pageX,g(window).on("mousemove",h.fn.onSplitterMouseMove),g(window).on("mouseup",h.fn.onSplitterMouseUp)},onSplitterMouseMove:a=>{h.data.splitter.cursor.prev=h.data.splitter.cursor.current,h.data.splitter.cursor.current=a.pageX,h.data.width.current=h.data.splitter.cursor.startWidth+(h.data.splitter.cursor.current-h.data.splitter.cursor.start),Cookies.set("mcmd-sidebar-width",h.data.width.current),h.fn.updateWidth(h.data.width.current)},onSplitterMouseUp:()=>{g(window).off("mousemove",h.fn.onSplitterMouseMove),g(window).off("mouseup",h.fn.onSplitterMouseUp)},onFolderCreate:()=>{if(h.globals.data.rights.c){const t=g("#mcmd-form-create");if(t.hasClass("mcmd-active"))t.removeClass("mcmd-active");else{g("#mcmd-form-sort").removeClass("mcmd-active");const o=t.find("#mcmd-folder-name"),r=t.find("#mcmd-folder-parent"),l=t.find("#mcmd-folder-color");o.val(""),h.colorpicker.set(l,null),r.off().empty().append(g("<option>").val(0).text(h.globals.msg.parent_folder));var a=h.data.tree.getFlatData();for(const i in a){var e=a[i];h.data.ticket?r.append(g("<option>").val(e.id).html("&nbsp;&nbsp;".repeat(e.level)+e.title).prop("selected",e.id===h.data.folder.active)):r.append(g("<option>").val(e.id).html("&nbsp;&nbsp;".repeat(e.level)+e.title))}function d(){t.removeClass("mcmd-active")}h.data.ticket||r.change(a=>{a.target.selectedIndex=0,h.notify.show(h.globals.msg.upgrade,"mcmd-upgrade")}),t.off("click"),t.one("click",".mcmd-close",()=>{d()}),t.one("click",".mcmd-submit",()=>{var a=o.val().split(",").map(a=>a.trim()),e=r.val(),t=h.colorpicker.get(l);h.fn.createFolders(a,t,e),d()}),t.addClass("mcmd-active")}}},onFolderCreateBuiltin:e=>{if(h.globals.data.rights.c){var a=h.data.ui.$tree.find(`.mcmd-tree-item[data-id=${e}]`);if(a.length){const n=g("<div>").addClass("mcmd-tree-nodes");var t=g("<div>").addClass("mcmd-tree-node"),d=g("<div>").addClass("mcmd-tree-item mcmd-tree-edited"),o=g("<div>").addClass("mcmd-tree-icon").append(h.data.tree.getIcon()),r=g("<div>").addClass("mcmd-tree-edit").attr({id:"mcmd-tree-edit"});const s=g("<input>").addClass("mcmd-tree-input").attr({spellcheck:"false",autocomplete:"off"});var l=g("<div>").addClass("mcmd-tree-btn-enter");function i(){n.remove(),h.data.tree.toggleDragDrop(!0)}h.data.tree.toggleDragDrop(!1),a.parent().append(n.append(t.append(d.append(o,r.append(s,l))))),s.focus().val(h.globals.msg.new_folder).one("blur",()=>{i()}).on("keyup",a=>{13!=a.keyCode&&27!=a.keyCode||(i(),13==a.keyCode&&(a=s.val().split(",").map(a=>a.trim()),h.fn.createFolders(a,null,e)))})}}},onFolderCopy:a=>{h.data.folder.copy=a},onFolderPaste:a=>{null!=h.data.folder.copy&&h.fn.copyFolders(h.data.folder.copy,a)},onFolderDelete:e=>{const a=g("<div>").addClass("mcmd-modal"),t=g("#mcmd-form-delete").clone();function d(){a.remove()}t.off("click"),t.one("click",".mcmd-close",()=>{d()}),t.one("click",".mcmd-submit",()=>{var a=t.find("#mcmd-delete-attachments").is(":checked");h.fn.deleteFolders(e.map(a=>a.id),a),d()}),g("body").append(a.append(t)),setTimeout(()=>{a.addClass("mcmd-active"),t.addClass("mcmd-active")})},onFolderDownload:a=>{h.fn.downloadFolders(a.map(a=>a.id))},onFolderSort:()=>{const d=g("#mcmd-form-sort");if(d.hasClass("mcmd-active"))d.removeClass("mcmd-active");else{g("#mcmd-form-create").removeClass("mcmd-active");let t=h.data.meta.sort.items;t&&d.find(`.mcmd-sort-types [data="${t}"]`).addClass("mcmd-active"),d.find(".mcmd-sort-type").off().on("click",a=>{var e;h.data.ticket?(e=(a=g(a.target)).attr("data"),d.find(".mcmd-sort-type").removeClass("mcmd-active"),a.toggleClass("mcmd-active",t!==e),t=t===e?null:e,h.data.meta.sort.items!==t&&(h.data.meta.sort.items=t,h.data.loader.request&&h.data.loader.request.abort(),h.data.loader.request=h.fn.updateMeta(),h.data.loader.request.always(()=>{h.data.loader.request=null,h.fn.activateFolder(h.data.folder.active,!1,!0)}))):h.notify.show(h.globals.msg.upgrade,"mcmd-upgrade")}),d.off("click"),d.one("click",".mcmd-close",()=>{d.removeClass("mcmd-active")}),d.addClass("mcmd-active")}},onFolderClick:a=>{clearTimeout(h.data.click.timerId),a.shiftKey||a.ctrlKey||g(a.target).hasClass("mcmd-tree-toggle")||1!==a.detail||(a=g(a.currentTarget)).hasClass("mcmd-tree-edited")||(h.data.click.folder=a.attr("data-id"),h.data.click.timerId=setTimeout(h.fn.onFolderClickAction,300))},onFolderClickAction:()=>{h.data.click.timerId=null;var a=h.data.click.folder;-1!=a&&-2!=a||h.data.tree.clearSelection(),h.fn.activateFolder(a)},onFolderDblClick:a=>{if(h.globals.data.rights.e){a.preventDefault();const t=g(a.currentTarget),d=(a=t.attr("data-id"),h.data.tree.getItem(a));if(d&&!t.hasClass("mcmd-tree-edited")){const o=g("<div>").addClass("mcmd-tree-edit").attr({id:"mcmd-tree-edit"}),r=g("<input>").addClass("mcmd-tree-input").attr({spellcheck:"false",autocomplete:"off"});function e(){o.remove(),t.removeClass("mcmd-tree-edited"),h.data.tree.toggleDragDrop(!0)}a=g("<div>").addClass("mcmd-tree-btn-enter"),h.data.tree.toggleDragDrop(!1),t.append(o.append(r,a)).addClass("mcmd-tree-edited"),r.focus().val(d.title).one("blur",()=>{e()}).on("keyup",a=>{13!=a.keyCode&&27!=a.keyCode||(e(),13==a.keyCode&&(a=r.val(),t.find(".mcmd-tree-title").text(a),h.fn.renameFolder(d.id,a)))})}}},onContextMenu:a=>{if(h.globals.data.rights.c||h.globals.data.rights.e||h.globals.data.rights.d){const n=g(a.currentTarget),s=n.attr("data-id");if(-1!=s&&-2!=s){var e=h.data.tree.getItem(s);e.state.selected||(h.data.tree.clearSelection(),h.data.tree.selectItem(s,!0)),a.preventDefault();const c=h.data.tree.getSelectedItems(),m=g("<div>").addClass("mcmd-contextmenu").attr({tabindex:-1});var t=g("body");const p=()=>{m.remove(),h.data.tree.clearSelection()};var d=a=>{h.fn.colorFolders(c.map(a=>a.id),a),p()};for(const f of h.data.contextmenu.list)if(!(!h.globals.data.rights.c&&"c"==f.right||!h.globals.data.rights.v&&"v"==f.right||!h.globals.data.rights.e&&"e"==f.right||!h.globals.data.rights.d&&"d"==f.right||"attachment"!==h.globals.data.type&&"download"==f.id)){var o=g("<div>").addClass("mcmd-item").attr({"data-id":f.id}),r=g("<div>").addClass("mcmd-icon").html(f.icon),l=g("<div>").addClass("mcmd-title").text(f.title);switch(m.append(o.append(r,l)),f.id){case"create":m.append(g("<div>").addClass("mcmd-splitter"));break;case"color":{const u=g("<div>").addClass("mcmd-submenu");new MEDIACOMMANDER.PLUGINS.COLORPICKER(e.color,u,d),o.append(u),o.on("mouseover mouseout",a=>{u.toggleClass("mcmd-active","mouseover"==a.type),"mouseover"!==a.type&&m.focus()})}break;case"paste":o.toggleClass("mcmd-disabled",null==h.data.folder.copy);break;case"delete":o.addClass("mcmd-alert")}}var i=(a=a.originalEvent).clientY,a=a.clientX;m.css({top:i,left:a}).on("blur",a=>{a.currentTarget.contains(a.relatedTarget)||p()}).on("click",".mcmd-item",a=>{switch(g(a.target).data("id")){case"create":h.data.ticket?h.fn.onFolderCreateBuiltin(s):h.notify.show(h.globals.msg.upgrade,"mcmd-upgrade"),p();break;case"rename":n.dblclick(),p();break;case"copy":h.data.ticket?h.fn.onFolderCopy(s):h.notify.show(h.globals.msg.upgrade,"mcmd-upgrade"),p();break;case"paste":h.data.ticket?h.fn.onFolderPaste(s):h.notify.show(h.globals.msg.upgrade,"mcmd-upgrade"),p();break;case"delete":h.fn.onFolderDelete(c),p();break;case"download":h.fn.onFolderDownload(c),p()}}),t.append(m),m.focus()}}},onSearchInput:a=>{h.fn.filterFolders(a.target.value)},onSearchClear:()=>{g("#mcmd-search-input").val(""),h.fn.filterFolders()},onAttachmentFolderEnter:a=>{h.data.dragdrop.$target=g(a.currentTarget).addClass("mcmd-droppable")},onAttachmentFolderLeave:()=>{h.data.dragdrop.$target&&h.data.dragdrop.$target.removeClass("mcmd-droppable"),h.data.dragdrop.$target=null},onAttachmentFolderUnderPointer:a=>{a=g(document.elementFromPoint(a.originalEvent.touches[0].clientX,a.originalEvent.touches[0].clientY)).closest(".mcmd-tree-item"),h.data.dragdrop.$target&&h.data.dragdrop.$target.removeClass("mcmd-droppable"),h.data.dragdrop.$target=null,a.length&&(h.data.dragdrop.$target=a.addClass("mcmd-droppable"))},onAttachmentDown:e=>{var t="touchstart"===e.type&&e.originalEvent.touches&&1==e.originalEvent.touches.length;if(1===e.which||t)if(h.data.media){if(h.data.mediaBrowse){t||e.preventDefault(),t||e.stopImmediatePropagation();const a=[];g('.media-frame .media-frame-content .attachment[aria-checked="true"]').each(function(){a.push(g(this).attr("data-id"))}),0==a.length&&a.push(g(e.currentTarget).attr("data-id")),a.length&&(h.data.dragdrop.isTouch=t,h.data.dragdrop.items=a,h.data.dragdrop.$ghost.text("Move "+a.length+" items").appendTo("body"),t?(document.addEventListener("touchmove",h.fn.onTouchMove,{passive:!1}),g(window).on("touchmove",h.fn.onAttachmentFolderUnderPointer),g(window).on("touchmove",h.fn.onAttachmentMove),g(window).on("touchend",h.fn.onAttachmentUp)):(h.data.ui.$sidebar.on("mouseenter",".mcmd-tree-item",h.fn.onAttachmentFolderEnter),h.data.ui.$sidebar.on("mouseleave",".mcmd-tree-item",h.fn.onAttachmentFolderLeave),g(window).on("mousemove",h.fn.onAttachmentMove),g(window).on("mouseup",h.fn.onAttachmentUp)))}}else{t||e.preventDefault(),t||e.stopImmediatePropagation();const d=[];let a="post";switch(h.globals.data.type){case"attachment":a="media";break;case"users":a="users";break;case"plugins":a="checked"}g(`#the-list input[name='${a}[]']:checked`).each(function(){d.push(g(this).val())}),0==d.length&&d.push(g(e.currentTarget).find("input").val()),d.length&&(h.data.dragdrop.isTouch=t,h.data.dragdrop.items=d,h.data.dragdrop.$ghost.text("Move "+d.length+" items").appendTo("body"),t?(document.addEventListener("touchmove",h.fn.onTouchMove,{passive:!1}),g(window).on("touchmove",h.fn.onAttachmentFolderUnderPointer),g(window).on("touchmove",h.fn.onAttachmentMove),g(window).on("touchend",h.fn.onAttachmentUp)):(h.data.ui.$sidebar.on("mouseenter",".mcmd-tree-item",h.fn.onAttachmentFolderEnter),h.data.ui.$sidebar.on("mouseleave",".mcmd-tree-item",h.fn.onAttachmentFolderLeave),g(window).on("mousemove",h.fn.onAttachmentMove),g(window).on("mouseup",h.fn.onAttachmentUp)))}},onAttachmentMove:a=>{h.data.dragdrop.items&&h.data.dragdrop.items.length&&(a=h.data.dragdrop.isTouch?a.originalEvent.touches[0]:a,h.data.dragdrop.$ghost.addClass("mcmd-active").css({top:a.clientY+5+"px",left:a.clientX+5+"px"}))},onAttachmentUp:()=>{var a=h.data.dragdrop.$target?h.data.dragdrop.$target.attr("data-id"):null,e=h.data.dragdrop.items;h.data.dragdrop.$ghost.text("").removeClass("mcmd-active").detach(),h.data.dragdrop.$target&&h.data.dragdrop.$target.removeClass("mcmd-droppable"),h.data.dragdrop.$target=null,h.data.dragdrop.items=null,clearTimeout(h.data.dragdrop.timerId),h.data.dragdrop.timerId=null,h.data.dragdrop.isTouch?(document.removeEventListener("touchmove",h.fn.onTouchMove,{passive:!1}),g(window).off("touchmove",h.fn.onAttachmentFolderUnderPointer),g(window).off("touchmove",h.fn.onAttachmentMove),g(window).off("touchend",h.fn.onAttachmentUp)):(h.data.ui.$sidebar.off("mouseenter",".mcmd-tree-item",h.fn.onAttachmentFolderEnter),h.data.ui.$sidebar.off("mouseleave",".mcmd-tree-item",h.fn.onAttachmentFolderLeave),g(window).off("mousemove",h.fn.onAttachmentMove),g(window).off("mouseup",h.fn.onAttachmentUp)),h.fn.dropAttachments(a,e)},onMediaModalPrepare:()=>{},onMediaModalOpen:()=>{h.data.modal||(h.data.modal=!0,h.data.ticket||wp&&wp.blocks?h.fn.loadSidebar():h.fn.loadProposal())},onMediaModalClose:()=>{h.data.modal=!1,h.data.ui.$container&&h.data.ui.$container.remove(),h.data.ui.$minitools&&h.data.ui.$minitools.remove(),h.data.ui.$mediaframe&&h.data.ui.$mediaframe.removeClass("mcmd-active")},onAjaxComplete:(a,e,t)=>{null!=t.data&&"string"==typeof t.data&&-1<t.data.indexOf("action=delete-post")&&(t=(t=h.data.tree.getFlatData())?t.map(a=>a.id):null,h.fn.activateFolder(h.data.folder.active,!1,!0),h.fn.updateFoldersAttachCount(t),h.fn.updateNoticeAndSearch())},onShowMediaDetails:a=>{var e,t;(a=g(a.target)).hasClass("mcmd-has-preview-details")||(e=a.attr("data-id"))&&(t=window.wp.media.attachment(e)).attributes&&t.attributes.preview_details&&(a.addClass("mcmd-has-preview-details"),g(".attachment[data-id="+e+"] .attachment-preview").prepend(t.attributes.preview_details))},onTouchMove:a=>{a.preventDefault(),clearTimeout(h.data.dragdrop.timerId),a.touches[0].clientY<30?h.data.dragdrop.timerId=setTimeout(h.fn.scroll.bind(null,-window.innerHeight/5),150):a.touches[0].clientY>window.innerHeight-30&&(h.data.dragdrop.timerId=setTimeout(h.fn.scroll.bind(null,window.innerHeight/5),150))},scroll:a=>{window.scrollBy({top:a,behavior:"smooth"}),h.data.dragdrop.timerId=setTimeout(h.fn.scroll.bind(null,a),150)},formatBytes:a=>{let e=0,t=parseInt(a,10)||0;for(;1024<=t&&++e;)t/=1024;return t.toFixed(t<10&&0<e?1:0)+" "+["bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][e]},uploader:{build:()=>{h.data.uploader.$container=g("<div>").addClass("mcmd-uploader"),h.data.uploader.$header=g("<div>").addClass("mcmd-header").text("Upload"),h.data.uploader.$title=g("<div>").addClass("mcmd-title"),h.data.uploader.$count=g("<div>").addClass("mcmd-count"),h.data.uploader.$close=g("<div>").addClass("mcmd-close").html('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d=" M 7.734 6.281 L 6.328 7.688 L 10.609 11.969 L 6.266 16.313 L 7.672 17.719 L 12.016 13.375 L 16.328 17.688 L 17.734 16.281 L 13.422 11.969 L 17.672 7.719 L 16.266 6.313 L 12.016 10.563 L 7.734 6.281 Z "></path></svg>'),h.data.uploader.$data=g("<div>").addClass("mcmd-data"),h.data.uploader.$container.append(h.data.uploader.$header.append(h.data.uploader.$title,h.data.uploader.$count,h.data.uploader.$close),h.data.uploader.$data),h.data.ui.$container.append(h.data.uploader.$container),h.data.uploader.$close.on("click",h.fn.uploader.close)},open:()=>{h.data.uploader.$container.addClass("mcmd-active")},close:()=>{h.data.uploader.$container.removeClass("mcmd-active"),h.data.uploader.$close.removeClass("mcmd-active"),h.data.uploader.$data.empty(),h.data.uploader.list.filter(a=>!a.loaded).length&&(h.data.uploader.instance.stop(),h.fn.uploader.complete()),h.data.uploader.list=[]},complete:()=>{var a=h.data.uploader.list.map(a=>a.folder).filter((a,e,t)=>t.indexOf(a)==e);h.fn.activateFolder(h.data.folder.active,!1,!0),h.fn.updateFoldersAttachCount(a),h.fn.updateNoticeAndSearch()},addFile:a=>{var e={id:a.id,folder:a._folder,loaded:!1},e=(h.data.uploader.list.push(e),h.data.tree.getItem(a._folder)),t=g("<div>").addClass("mcmd-item").attr({"data-id":a.id}),d=g("<div>").addClass("mcmd-title").text(a.name),a=g("<div>").addClass("mcmd-info").text(h.fn.formatBytes(a.size)+(e?" ["+e.title+"]":""));h.data.uploader.$data.prepend(t.append(d,a))},completeFile:a=>{h.data.uploader.$data.find(`.mcmd-item[data-id="${a.id}"]`).addClass("mcmd-loaded");for(const e of h.data.uploader.list)if(e.id===a.id){e.loaded=!0;break}h.fn.uploader.updateHeader()},updateHeader:()=>{var a=h.data.uploader.list.filter(a=>a.loaded).length;h.data.uploader.$count.text(a+" / "+h.data.uploader.list.length)}},replacemedia:{open:a=>{const e={data:{$modal:g("<div>").addClass("mcmd-modal"),$form:g("#mcmd-form-replace-media").clone(),attachment:g(a).attr("data-attachment-id"),file:null},fn:{build:()=>{e.data.$fileDropZone=e.data.$form.find(".mcmd-file-drop-zone"),e.data.$fileUpload=e.data.$form.find(".mcmd-file-upload"),e.data.$imagePreview=e.data.$form.find(".mcmd-image-preview"),e.data.$fileSelect=e.data.$form.find(".mcmd-file-select"),e.data.$fileSubmit=e.data.$form.find(".mcmd-btn.mcmd-submit"),e.data.$loader=e.data.$form.find(".mcmd-loader"),g("body").append(e.data.$modal.append(e.data.$form)),setTimeout(()=>{e.data.$modal.addClass("mcmd-active"),e.data.$form.addClass("mcmd-active")})},bind:()=>{e.data.$form.on("click",".mcmd-close",e.fn.close),e.data.$form.on("click",".mcmd-submit",e.fn.submit),e.data.$modal.on("dragenter dragover drop",()=>!1),e.data.$fileUpload.on("change",e.fn.selectFile),e.data.$fileSelect.on("click",()=>{e.data.$fileUpload.click()}),(new XMLHttpRequest).upload&&(e.data.$fileDropZone.on("dragover dragleave",e.fn.dragHover),e.data.$fileDropZone.on("drop",e.fn.selectFile))},loading:a=>{e.data.$loader.toggleClass("mcmd-active",a)},dragHover:a=>(a.currentTarget.contains(a.relatedTarget)||e.data.$fileDropZone.toggleClass("mcmd-hover","dragover"===a.type),!1),selectFile:a=>{e.data.file=null,e.data.$fileSubmit.addClass("mcmd-hidden"),e.fn.dragHover(a),1==(a=a.originalEvent.target.files||a.originalEvent.dataTransfer.files).length?(a=a[0],/\.(?=gif|jpg|png|jpeg)/gi.test(a.name)?(e.data.file=a,e.data.$fileDropZone.addClass("mcmd-preview"),e.data.$imagePreview.get(0).src=URL.createObjectURL(e.data.file),e.data.$fileSubmit.removeClass("mcmd-hidden")):(e.data.$fileDropZone.removeClass("mcmd-preview"),e.data.$fileDropZone.get(0).reset())):h.notify.show(h.globals.msg.failed,"mcmd-failed")},show:()=>{e.fn.build(),e.fn.bind()},close:()=>{e.data.$modal.remove()},submit:()=>{var a;null!=e.data.file&&((a=new FormData).append("file",e.data.file),a.append("attachment",e.data.attachment),e.fn.loading(!0),g.ajax({url:h.globals.api.url+"/replace-media",type:"POST",data:a,processData:!1,contentType:!1,headers:{"X-WP-Nonce":h.globals.api.nonce}}).done(a=>{a&&a.success?(e.fn.close(),h.notify.show(h.globals.msg.success,"mcmd-success"),h.fn.activateFolder(h.data.folder.active,!1,!0),h.data.editAttachments&&h.data.editAttachments.updateMediaData()):h.notify.show(h.globals.msg.failed,"mcmd-failed")}).fail(()=>{h.notify.show(h.globals.msg.failed,"mcmd-failed")}).always(()=>{e.fn.loading(!1)}))}}};e.fn.show()}}}};g(()=>{h.fn.run()}),window.MEDIACOMMANDER=window.MEDIACOMMANDER||{},window.MEDIACOMMANDER.APP=h}(jQuery);